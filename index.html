<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Matrix Dev Escape</title>
    <style>
      :root {
        --matrix-green: #00ff41;
        --bg: #000;
        --grid-color: rgba(0, 255, 65, 0.15);
        --modal-bg: rgba(0, 10, 0, 0.98);
        --danger: #ff3e3e;
        --game-width: 450px;
      }

      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: #0a0a0a;
        color: var(--matrix-green);
        font-family: "Courier New", monospace;
        overflow: hidden;
        display: flex;
        justify-content: center;
      }

      #mobile-container {
        width: 100%;
        max-width: var(--game-width);
        height: 100vh;
        background: var(--bg);
        display: flex;
        flex-direction: column;
        border-left: 1px solid #222;
        border-right: 1px solid #222;
      }

      /* Viewport maior para mais espaço de scroll */
      #viewport {
        flex: 1; /* Ocupa todo o espaço restante */
        overflow: auto;
        scroll-snap-type: both mandatory;
        border-bottom: 1px solid var(--matrix-green);
      }

      #world {
        display: grid;
        grid-template-columns: repeat(10, var(--game-width));
        grid-template-rows: repeat(10, 70vh); /* Seções mais altas */
        width: calc(var(--game-width) * 10);
        height: 700vh;
      }

      .section {
        width: var(--game-width);
        height: 70vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        scroll-snap-align: start;
        padding: 20px;
        box-sizing: border-box;
        border: 1px solid rgba(0, 255, 65, 0.05); /* Grade suave no mundo */
      }

      /* Coordenadas mais visíveis */
      .coord-label {
        font-size: 1.2rem;
        opacity: 0.4;
        font-weight: bold;
      }

      /* Footer fixo no Bottom */
      #footer {
        height: 160px; /* Altura fixa para o painel de controle */
        background: #000;
        display: flex;
        flex-direction: row; /* Lado a lado */
        padding: 10px;
        gap: 10px;
        box-sizing: border-box;
        border-top: 2px solid var(--matrix-green);
      }

      #mini-map {
        flex: 1; /* Mapa ocupa metade */
        height: 100%;
        background: #000;
        border: 1px solid var(--matrix-green);
        position: relative;
        overflow: hidden;
        background-image: linear-gradient(
            to right,
            var(--grid-color) 1px,
            transparent 1px
          ),
          linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
        background-size: 10% 10%;
      }

      #player-dot {
        position: absolute;
        width: 6px;
        height: 6px;
        background: #fff;
        border-radius: 50%;
        box-shadow: 0 0 8px #fff;
        z-index: 5;
        transform: translate(-50%, -50%);
      }

      #backpack {
        flex: 1; /* Mochila ocupa a outra metade */
        font-size: 0.65rem;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }

      #map-light {
        position: absolute;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          circle 40px at 0% 0%,
          rgba(0, 255, 65, 0.2) 0%,
          #000 100%
        );
        z-index: 1;
        pointer-events: none;
      }

      /* Modal */
      #modal-overlay {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 100;
        justify-content: center;
        align-items: center;
      }

      #modal {
        background: var(--modal-bg);
        border: 1px solid var(--matrix-green);
        padding: 20px;
        width: 85%;
        text-align: center;
      }

      #modal input {
        background: #000;
        border: 1px solid var(--matrix-green);
        color: var(--matrix-green);
        width: 90%;
        padding: 10px;
        margin: 10px 0;
        font-family: "Courier New";
        font-size: 16px;
      }

      .btn {
        background: transparent;
        border: 1px solid var(--matrix-green);
        color: var(--matrix-green);
        padding: 8px;
        cursor: pointer;
        font-family: "Courier New";
      }

      .task-node {
        position: absolute;
        width: 4px;
        height: 4px;
        background: var(--matrix-green);
        border-radius: 50%;
        transform: translate(-50%, -50%);
      }

      .skill-tag {
        display: inline-block;
        padding: 2px 4px;
        border: 1px solid var(--matrix-green);
        margin: 1px;
        font-size: 0.55rem;
      }
    </style>
  </head>
  <body>
    <div id="mobile-container">
      <div id="viewport">
        <div id="world"></div>
      </div>

      <div id="footer">
        <div id="mini-map">
          <div id="map-light"></div>
          <div id="player-dot"></div>
        </div>

        <div id="backpack">
          <strong style="border-bottom: 1px solid #333; margin-bottom: 5px"
            >SKILLS:</strong
          >
          <div id="skill-list">Vazia</div>
          <div
            id="gate-status"
            style="margin-top: auto; color: gold; font-size: 0.6rem"
          ></div>
        </div>
      </div>

      <div id="modal-overlay">
        <div id="modal">
          <h2 id="modal-title" style="font-size: 0.9rem">NODE ACCESS</h2>
          <p id="modal-question" style="font-size: 0.8rem">...</p>
          <div id="modal-body"></div>
          <div id="modal-footer" style="margin-top: 10px">
            <button class="btn" onclick="closeModal()">CANCEL</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const world = document.getElementById("world");
      const viewport = document.getElementById("viewport");
      const dot = document.getElementById("player-dot");
      const light = document.getElementById("map-light");
      const skillListUI = document.getElementById("skill-list");
      const gateStatusUI = document.getElementById("gate-status");
      const overlay = document.getElementById("modal-overlay");

      let inventory = [];
      let currentCoord = "";

      const gameData = {
        // Originais
        "1,1": {
          q: "LINUX: List files command?",
          a: "ls",
          skill: "LINUX_SHELL",
        },
        "4,2": {
          q: "DOCKER: Active containers command?",
          a: "docker ps",
          skill: "DOCKER_PS",
        },
        "7,6": {
          q: "SQL: Extract data command?",
          a: "select",
          skill: "SQL_SELECT",
        },

        // JavaScript (JS)
        "0,3": {
          q: "JS: Keyword for a constant variable?",
          a: "const",
          skill: "JS_CONST",
        },
        "2,5": {
          q: "JS: Method to add item at end of array?",
          a: "push",
          skill: "JS_PUSH",
        },
        "5,0": {
          q: "JS: Which data type is [1, 2, 3]?",
          a: "object",
          skill: "JS_ARRAY_TYPE",
        },

        // React
        "3,8": {
          q: "REACT: Hook used for side effects?",
          a: "useeffect",
          skill: "REACT_EFFECT",
        },
        "6,1": {
          q: "REACT: Hook to manage state?",
          a: "usestate",
          skill: "REACT_STATE",
        },
        "8,4": {
          q: "REACT: Extension for components using HTML-like syntax?",
          a: "jsx",
          skill: "REACT_JSX",
        },
        "1,7": {
          q: "REACT: Property to pass data to children?",
          a: "props",
          skill: "REACT_PROPS",
        },

        // Node.js
        "4,9": {
          q: "NODE: File used to manage dependencies?",
          a: "package.json",
          skill: "NODE_PACKAGE",
        },
        "9,2": {
          q: "NODE: Default tool to install packages?",
          a: "npm",
          skill: "NODE_NPM",
        },
        "2,2": {
          q: "NODE: Method to export modules in CommonJS?",
          a: "module.exports",
          skill: "NODE_EXPORT",
        },

        "9,9": { type: "EXIT" },
      };

      // Atualize a lista de verificação
      const requiredSkills = Object.keys(gameData)
        .filter((k) => gameData[k].skill)
        .map((k) => gameData[k].skill);

      // Build World
      for (let r = 0; r < 10; r++) {
        for (let c = 0; c < 10; c++) {
          const coord = `${c},${r}`;
          const sec = document.createElement("section");
          sec.className = "section";

          if (gameData[coord]) {
            const node = document.createElement("div");
            node.className = "task-node";
            node.id = `node-${coord}`;
            node.style.left = `${c * 10 + 5}%`;
            node.style.top = `${r * 10 + 5}%`;
            if (gameData[coord].type === "EXIT") node.style.background = "gold";
            document.getElementById("mini-map").appendChild(node);

            if (gameData[coord].type === "EXIT") {
              sec.innerHTML = `<h2 style="color:gold;">[ GATE ${coord} ]</h2><button class="btn" onclick="checkExit()">UNSEAL GATE</button>`;
            } else {
              sec.innerHTML = `<h2>[ NODE ${coord} ]</h2><button class="btn" onclick="openTerminal('${coord}')">DECRYPT</button>`;
            }
          } else {
            sec.innerHTML = `<span class="coord-label">${coord}</span>`;
          }
          world.appendChild(sec);
        }
      }

      function openTerminal(coord) {
        currentCoord = coord;
        document.getElementById("modal-title").innerText = "NODE " + coord;
        document.getElementById("modal-question").innerText = gameData[coord].q;
        document.getElementById("modal-body").innerHTML = `
                <input type="text" id="modal-input" placeholder="..." autocomplete="off">
                <button class="btn" style="width:100%" onclick="submitAnswer()">EXECUTE</button>
            `;
        overlay.style.display = "flex";
        setTimeout(() => document.getElementById("modal-input").focus(), 100);
      }

      function submitAnswer() {
        const val = document
          .getElementById("modal-input")
          .value.toLowerCase()
          .trim();
        const data = gameData[currentCoord];
        if (val === data.a) {
          if (!inventory.includes(data.skill)) inventory.push(data.skill);
          document.getElementById(`node-${currentCoord}`).style.background =
            "white";
          updateUI();
          closeModal();
        } else {
          alert("ACCESS DENIED");
        }
      }

      function checkExit() {
        let html = "";
        requiredSkills.forEach((s) => {
          const has = inventory.includes(s);
          html += `<div class="skill-tag" style="color:${
            has ? "#0f0" : "#f44"
          }">${has ? "✔" : "✘"} ${s}</div>`;
        });
        if (inventory.length >= 3) {
          html += `<br><button class="btn" style="margin-top:10px" onclick="location.reload()">TERMINATE SYSTEM</button>`;
        }
        document.getElementById("modal-title").innerText = "EXIT PROTOCOL";
        document.getElementById("modal-question").innerText =
          "Required Skills:";
        document.getElementById("modal-body").innerHTML = html;
        overlay.style.display = "flex";
      }

      function closeModal() {
        overlay.style.display = "none";
      }

      function updateUI() {
        skillListUI.innerHTML = inventory.length
          ? inventory.map((s) => `<div class="skill-tag">${s}</div>`).join("")
          : "Vazia";
        gateStatusUI.innerText = `KEYS: ${inventory.length}/3`;
      }

      viewport.addEventListener("scroll", () => {
        const pctX =
          viewport.scrollLeft / (viewport.scrollWidth - viewport.clientWidth);
        const pctY =
          viewport.scrollTop / (viewport.scrollHeight - viewport.clientHeight);
        const mapW = document.getElementById("mini-map").clientWidth;
        const mapH = document.getElementById("mini-map").clientHeight;
        const posX = pctX * (mapW * 0.9) + mapW * 0.05;
        const posY = pctY * (mapH * 0.9) + mapH * 0.05;
        dot.style.left = `${posX}px`;
        dot.style.top = `${posY}px`;
        light.style.background = `radial-gradient(circle 40px at ${posX}px ${posY}px, rgba(0, 255, 65, 0.4) 0%, #000 100%)`;
      });

      updateUI();
    </script>
  </body>
</html>
