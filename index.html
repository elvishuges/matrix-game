<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Matrix Dev: Final Edition</title>
    <style>
      :root {
        --matrix-green: #00ff41;
        --bg: #000;
        --grid-color: rgba(0, 255, 65, 0.15);
        --game-width: 450px;
        --vision-range: 120px;
      }

      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: #050505;
        color: var(--theme-color, var(--matrix-green));
        font-family: "Courier New", Courier, monospace;
        overflow: hidden;
        display: flex;
        justify-content: center;
        overscroll-behavior-y: contain;
      }

      #mobile-container {
        width: 100%;
        max-width: var(--game-width);
        height: 100vh;
        background: var(--bg);
        display: flex;
        flex-direction: column;
        border-left: 1px solid #222;
        border-right: 1px solid #222;
        position: relative;
      }

      /* HUD Superior */
      #status-bar {
        background: #000;
        border-bottom: 2px solid currentColor;
        padding: 10px;
        font-size: 0.8rem;
        z-index: 20;
      }

      #dialogue-box {
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        margin-top: 8px;
        padding-top: 8px;
        color: #fff;
        min-height: 35px;
        font-size: 0.75rem;
      }

      /* Mundo e Scroll */
      #viewport {
        flex: 1;
        overflow: auto;
        scroll-snap-type: both mandatory;
        position: relative;
        background-image: linear-gradient(
            to right,
            var(--grid-color) 1px,
            transparent 1px
          ),
          linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
        background-size: 100% 70vh;
      }

      #world {
        display: grid;
        grid-template-columns: repeat(10, var(--game-width));
        grid-template-rows: repeat(10, 70vh);
        width: calc(var(--game-width) * 10);
        height: 700vh;
      }

      .section {
        width: var(--game-width);
        height: 70vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        scroll-snap-align: start;
        scroll-snap-stop: always;
      }

      /* Efeitos de Luz */
      #proximity-mask {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 5;
        background: radial-gradient(
          circle var(--vision-range) at var(--x, 50%) var(--y, 50%),
          transparent 0%,
          rgba(0, 0, 0, 1) 100%
        );
        display: none;
      }

      /* Rodapé */
      #footer {
        height: 180px;
        background: #000;
        display: flex;
        padding: 12px;
        gap: 12px;
        border-top: 2px solid currentColor;
      }

      #mini-map {
        width: 140px;
        height: 140px;
        border: 1px solid currentColor;
        position: relative;
        overflow: hidden;
        background-image: linear-gradient(
            to right,
            var(--grid-color) 1px,
            transparent 1px
          ),
          linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
        background-size: 10% 10%;
      }

      #map-light {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 8;
        background: radial-gradient(
          circle 35px at var(--mx, 50%) var(--my, 50%),
          transparent 0%,
          rgba(0, 0, 0, 1) 90%
        );
        display: none;
      }

      #player-dot {
        position: absolute;
        width: 6px;
        height: 6px;
        background: #fff;
        border-radius: 50%;
        box-shadow: 0 0 8px #fff;
        transform: translate(-50%, -50%);
        z-index: 10;
        transition: 0.05s linear;
      }

      .controls {
        flex: 1;
        display: flex;
        flex-direction: column;
        font-size: 0.7rem;
      }

      .btn {
        background: transparent;
        border: 1px solid currentColor;
        color: inherit;
        padding: 8px;
        cursor: pointer;
        font-family: "Courier New", monospace;
        text-transform: uppercase;
        font-weight: bold;
      }

      #skill-container {
        margin-top: 10px;
        flex: 1;
        overflow-y: auto;
      }

      .skill-tag {
        display: inline-block;
        padding: 2px 5px;
        border: 1px solid currentColor;
        margin: 2px;
        font-size: 0.6rem;
        background: rgba(0, 255, 65, 0.05);
      }

      .task-node-map {
        position: absolute;
        width: 4px;
        height: 4px;
        background: currentColor;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        z-index: 7;
      }

      /* Modais */
      #modal-overlay {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 100;
        justify-content: center;
        align-items: center;
      }

      #modal {
        background: #000;
        border: 2px solid currentColor;
        padding: 20px;
        width: 85%;
        text-align: center;
      }
      #modal input {
        background: #000;
        border: 1px solid currentColor;
        color: #fff;
        width: 90%;
        padding: 12px;
        margin: 15px 0;
        font-family: "Courier New", monospace;
        text-align: center;
      }

      .timer-danger {
        color: #ff3e3e;
        animation: blink 0.5s infinite;
        font-weight: bold;
      }
      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <div id="mobile-container">
      <div id="status-bar">
        <div style="display: flex; justify-content: space-between">
          <span>FASE: <span id="phase-num">1</span></span>
          <span id="timer">00:00</span>
        </div>
        <div id="dialogue-box">Morpheus: Acorde, dev...</div>
      </div>

      <div id="viewport">
        <div id="proximity-mask"></div>
        <div id="world"></div>
      </div>

      <div id="footer">
        <div id="mini-map">
          <div id="map-light"></div>
          <div id="player-dot"></div>
        </div>
        <div class="controls">
          <div
            id="gate-info"
            style="
              font-weight: bold;
              border-bottom: 1px solid #333;
              padding-bottom: 4px;
            "
          >
            DATA: 0/0
          </div>
          <div id="skill-container">
            <div style="font-size: 0.55rem; opacity: 0.7; margin-bottom: 3px">
              SKILLS COLETADAS:
            </div>
            <div id="skill-list">Nenhuma</div>
          </div>
        </div>
      </div>

      <div id="modal-overlay">
        <div id="modal">
          <h2 id="modal-title">TERMINAL</h2>
          <p id="modal-question"></p>
          <div id="modal-body"></div>
          <div id="modal-footer" style="margin-top: 15px">
            <button class="btn" onclick="closeModal()">CANCELAR</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const gameFases = [
        {
          id: 1,
          nome: "A CAMADA 0",
          msg: "Morpheus: O grid está visível. Encontre os nós para prosseguir.",
          cor: "#00ff41",
          escuro: true,
          tempo: 120,
          perguntas: {
            "1,2": {
              q: "GIT: Comando para baixar repositório?",
              a: "git clone",
              s: "CLONE",
            },
            "5,5": {
              q: "CSS: Display que usa eixos X e Y?",
              a: "flex",
              s: "FLEX",
            },
            "9,9": { type: "EXIT" },
          },
        },
        {
          id: 2,
          nome: "SHADOW BYTES",
          msg: "Morpheus: Eles detectaram sua presença! O grid escureceu.",
          cor: "#00ccff",
          escuro: true,
          tempo: 90,
          perguntas: {
            "3,3": {
              q: "JS: Tipo de dado para verdadeiro/falso?",
              a: "boolean",
              s: "BOOL",
            },
            "7,1": { q: "HTML: Tag para a maior fonte?", a: "h1", s: "H1" },
            "0,5": { type: "EXIT" },
          },
        },
      ];

      let faseIdx = 0;
      let inventory = [];
      let timeLeft = 0;
      let timer;

      const viewport = document.getElementById("viewport");
      const world = document.getElementById("world");
      const minimap = document.getElementById("mini-map");
      const mainMask = document.getElementById("proximity-mask");
      const mapLight = document.getElementById("map-light");

      function carregarFase(idx) {
        const fase = gameFases[idx];
        faseIdx = idx;
        inventory = [];
        timeLeft = fase.tempo;

        document.documentElement.style.setProperty("--theme-color", fase.cor);
        document.getElementById(
          "phase-num"
        ).innerText = `${fase.id} - ${fase.nome}`;
        document.getElementById("dialogue-box").innerText =
          "Morpheus: " + fase.msg;

        mainMask.style.display = fase.escuro ? "block" : "none";
        mapLight.style.display = fase.escuro ? "block" : "none";

        renderWorld(fase);
        startTimer();
        updateUI();
        viewport.scrollTo(0, 0);
      }

      function renderWorld(fase) {
        world.innerHTML = "";
        minimap.querySelectorAll(".task-node-map").forEach((n) => n.remove());

        for (let r = 0; r < 10; r++) {
          for (let c = 0; c < 10; c++) {
            const coord = `${c},${r}`;
            const sec = document.createElement("section");
            sec.className = "section";
            const node = fase.perguntas[coord];

            if (node) {
              if (node.type === "EXIT") {
                sec.innerHTML = `<h1 style="color:gold">PORTAL</h1><button class="btn" onclick="checkExit()">AVANÇAR</button>`;
              } else {
                sec.innerHTML = `<h2>NODE ${coord}</h2><button class="btn" onclick="openTerminal('${coord}')">HACKEAR</button>`;
              }
              const mapDot = document.createElement("div");
              mapDot.className = "task-node-map";
              mapDot.style.left = `${c * 10 + 5}%`;
              mapDot.style.top = `${r * 10 + 5}%`;
              if (node.type === "EXIT") mapDot.style.background = "gold";
              minimap.appendChild(mapDot);
            } else {
              sec.innerHTML = `<span style="opacity:0.05; font-size:4rem">${coord}</span>`;
            }
            world.appendChild(sec);
          }
        }
      }

      function startTimer() {
        clearInterval(timer);
        timer = setInterval(() => {
          timeLeft--;
          const m = Math.floor(timeLeft / 60);
          const s = timeLeft % 60;
          const el = document.getElementById("timer");
          el.innerText = `${m}:${s.toString().padStart(2, "0")}`;
          el.className = timeLeft <= 10 ? "timer-danger" : "";
          if (timeLeft <= 0) {
            alert("TEMPO ESGOTADO!");
            location.reload();
          }
        }, 1000);
      }

      function openTerminal(coord) {
        const q = gameFases[faseIdx].perguntas[coord];
        document.getElementById("modal-overlay").style.display = "flex";
        document.getElementById("modal-question").innerText = q.q;
        document.getElementById("modal-body").innerHTML = `
            <input type="text" id="ans-input" placeholder="DIGITE..." autocomplete="off">
            <button class="btn" style="width:100%" onclick="submitAns('${coord}')">ENVIAR</button>
        `;
        setTimeout(() => document.getElementById("ans-input").focus(), 100);
      }

      function submitAns(coord) {
        const input = document
          .getElementById("ans-input")
          .value.toLowerCase()
          .trim();
        const node = gameFases[faseIdx].perguntas[coord];
        if (input === node.a) {
          if (!inventory.includes(node.s)) inventory.push(node.s);
          closeModal();
          updateUI();
        } else alert("ACESSO NEGADO");
      }

      function checkExit() {
        const req = Object.keys(gameFases[faseIdx].perguntas).length - 1;
        if (inventory.length >= req) {
          if (faseIdx < gameFases.length - 1) carregarFase(faseIdx + 1);
          else alert("MISSÃO CONCLUÍDA!");
        } else alert(`FALTAM DADOS: ${inventory.length}/${req}`);
      }

      function closeModal() {
        document.getElementById("modal-overlay").style.display = "none";
      }

      function updateUI() {
        const req = Object.keys(gameFases[faseIdx].perguntas).length - 1;
        document.getElementById(
          "gate-info"
        ).innerText = `DATA: ${inventory.length}/${req}`;
        const list = document.getElementById("skill-list");
        if (inventory.length === 0) {
          list.innerText = "Nenhuma";
        } else {
          list.innerHTML = inventory
            .map((s) => `<span class="skill-tag">${s}</span>`)
            .join("");
        }
      }

      viewport.addEventListener("scroll", () => {
        const px =
          viewport.scrollLeft /
          (viewport.scrollWidth - viewport.clientWidth || 1);
        const py =
          viewport.scrollTop /
          (viewport.scrollHeight - viewport.clientHeight || 1);

        mainMask.style.setProperty("--x", `${px * 100}%`);
        mainMask.style.setProperty("--y", `${py * 100}%`);

        const mx = px * 90 + 5;
        const my = py * 90 + 5;
        mapLight.style.setProperty("--mx", `${mx}%`);
        mapLight.style.setProperty("--my", `${my}%`);
        document.getElementById("player-dot").style.left = `${mx}%`;
        document.getElementById("player-dot").style.top = `${my}%`;
      });

      carregarFase(0);
    </script>
  </body>
</html>
