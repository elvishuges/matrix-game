<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Matrix Dev Escape</title>
    <style>
        :root {
            --matrix-green: #00ff41;
            --bg: #000;
            --grid-color: rgba(0, 255, 65, 0.1);
            --modal-bg: rgba(0, 15, 0, 0.98);
            --danger: #ff3e3e;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background: var(--bg);
            color: var(--matrix-green);
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        #viewport {
            width: 100vw; height: 45vh;
            overflow: auto;
            scroll-snap-type: both mandatory;
            border-bottom: 2px solid var(--matrix-green);
        }

        #world {
            display: grid;
            grid-template-columns: repeat(10, 100vw);
            grid-template-rows: repeat(10, 45vh);
            width: 1000vw; height: 450vh;
        }

        .section {
            width: 100vw; height: 45vh;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            scroll-snap-align: start;
            padding: 20px; box-sizing: border-box;
            text-align: center;
        }

        #footer {
            height: 55vh;
            display: flex; flex-direction: column;
            align-items: center; padding-top: 10px;
        }

        #mini-map {
            width: 90vw; height: 25vh;
            background: #000;
            border: 1px solid var(--matrix-green);
            position: relative; overflow: hidden;
            background-image: 
                linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
                linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
            background-size: 10% 10%;
        }

        #map-light {
            position: absolute; width: 100%; height: 100%;
            background: radial-gradient(circle 60px at 0% 0%, rgba(0,255,65,0.2) 0%, #000 100%);
            z-index: 1; pointer-events: none;
        }

        #player-dot {
            position: absolute; width: 10px; height: 10px;
            background: #fff; border-radius: 50%;
            box-shadow: 0 0 15px #fff;
            z-index: 5; transform: translate(-50%, -50%);
            transition: all 0.2s ease-out;
        }

        /* Pulsing Dots for Tasks */
        .task-node {
            position: absolute; width: 6px; height: 6px;
            background: var(--matrix-green); border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 65, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0); }
        }

        /* Modal */
        #modal-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100; justify-content: center; align-items: center;
        }

        #modal {
            background: var(--modal-bg);
            border: 2px solid var(--matrix-green);
            padding: 25px; width: 85%; max-width: 400px;
            text-align: center;
        }

        #modal input {
            background: #000; border: 1px solid var(--matrix-green);
            color: var(--matrix-green); width: 100%; padding: 12px;
            margin: 15px 0; font-family: 'Courier New';
        }

        .btn {
            background: transparent; border: 1px solid var(--matrix-green);
            color: var(--matrix-green); padding: 10px 20px;
            margin: 5px; cursor: pointer; font-family: 'Courier New';
        }

        /* Inventory List */
        #backpack {
            margin-top: 15px; width: 90vw;
            border-top: 1px solid #333; padding-top: 10px;
            font-size: 0.7rem; text-align: left;
        }

        .skill-tag {
            display: inline-block; padding: 2px 6px;
            border: 1px solid var(--matrix-green);
            margin: 2px; border-radius: 3px;
        }

        .missing { border-color: var(--danger); color: var(--danger); }
    </style>
</head>
<body>

    <div id="viewport">
        <div id="world"></div>
    </div>

    <div id="footer">
        <div id="mini-map">
            <div id="map-light"></div>
            <div id="player-dot"></div>
        </div>
        
        <div id="backpack">
            <strong>MOCHILA DE SKILLS:</strong>
            <div id="skill-list">Vazia</div>
            <div id="gate-status" style="margin-top:8px; font-weight:bold;"></div>
        </div>
    </div>

    <div id="modal-overlay">
        <div id="modal">
            <h2 id="modal-title" style="font-size:1rem;">ACCESSING TERMINAL</h2>
            <p id="modal-question">...</p>
            <div id="modal-body"></div>
            <div id="modal-footer" style="margin-top:20px;">
                <button class="btn" onclick="closeModal()">CANCEL</button>
            </div>
        </div>
    </div>

    <script>
        const world = document.getElementById('world');
        const viewport = document.getElementById('viewport');
        const dot = document.getElementById('player-dot');
        const light = document.getElementById('map-light');
        const skillListUI = document.getElementById('skill-list');
        const gateStatusUI = document.getElementById('gate-status');
        const overlay = document.getElementById('modal-overlay');

        let inventory = [];
        let solvedSectors = new Set();
        let currentCoord = "";

        const requiredSkills = ["LINUX_SHELL", "DOCKER_PS", "SQL_SELECT"];

        const gameData = {
            "1,1": { q: "LINUX: Command to list files?", a: "ls", skill: "LINUX_SHELL" },
            "4,2": { q: "DOCKER: Command to see active containers?", a: "docker ps", skill: "DOCKER_PS" },
            "7,6": { q: "SQL: Command to extract data?", a: "select", skill: "SQL_SELECT" },
            "9,9": { type: "EXIT" }
        };

        // Initialize World and Map
        for (let i = 0; i < 100; i++) {
            const r = Math.floor(i / 10);
            const c = i % 10;
            const coord = `${c},${r}`;
            const sec = document.createElement('section');
            sec.className = 'section';
            
            if (gameData[coord]) {
                const node = document.createElement('div');
                node.className = 'task-node';
                node.id = `node-${coord}`;
                node.style.left = `${(c * 10) + 5}%`;
                node.style.top = `${(r * 10) + 5}%`;
                document.getElementById('mini-map').appendChild(node);

                if(gameData[coord].type === "EXIT") {
                    sec.innerHTML = `<h2>[ EXIT GATE ]</h2><button class="btn" onclick="checkExit()">ACCESS GATE</button>`;
                    node.style.background = "gold";
                } else {
                    sec.innerHTML = `<h2>[ DATA NODE ${coord} ]</h2><button class="btn" onclick="openTerminal('${coord}')">CONNECT</button>`;
                }
            } else {
                sec.innerHTML = `<p style="opacity:0.1">BLOCK ${coord}</p>`;
            }
            world.appendChild(sec);
        }

        function openTerminal(coord) {
            currentCoord = coord;
            const data = gameData[coord];
            document.getElementById('modal-title').innerText = "ENCRYPTED NODE";
            document.getElementById('modal-question').innerText = data.q;
            document.getElementById('modal-body').innerHTML = `
                <input type="text" id="modal-input" placeholder="Type answer...">
                <button class="btn" onclick="submitAnswer()">SUBMIT</button>
            `;
            overlay.style.display = 'flex';
        }

        function submitAnswer() {
            const input = document.getElementById('modal-input').value.toLowerCase().trim();
            const data = gameData[currentCoord];
            if (input === data.a) {
                if (!inventory.includes(data.skill)) {
                    inventory.push(data.skill);
                    solvedSectors.add(currentCoord);
                    document.getElementById(`node-${currentCoord}`).style.animation = "none";
                    document.getElementById(`node-${currentCoord}`).style.background = "white";
                }
                updateUI();
                closeModal();
                alert("SKILL ACQUIRED: " + data.skill);
            } else {
                alert("ACCESS DENIED");
            }
        }

        function checkExit() {
            let html = "<h3>GATE SECURITY SCAN</h3>";
            let missingCount = 0;

            requiredSkills.forEach(skill => {
                const has = inventory.includes(skill);
                if (!has) missingCount++;
                html += `<div class="skill-tag ${has ? '' : 'missing'}">${has ? '✔' : '✘'} ${skill}</div>`;
            });

            if (missingCount === 0) {
                html += `<p style="color:gold; margin-top:15px;">ALL CRITERIA MET. OPENING...</p>
                         <button class="btn" onclick="location.reload()">ESCAPE SYSTEM</button>`;
            } else {
                html += `<p style="color:var(--danger); margin-top:15px;">ACCESS DENIED: ${missingCount} SKILLS MISSING.</p>`;
            }

            document.getElementById('modal-title').innerText = "GATE CHECKPOINT";
            document.getElementById('modal-question').innerText = "Inventory required to exit:";
            document.getElementById('modal-body').innerHTML = html;
            overlay.style.display = 'flex';
        }

        function closeModal() { overlay.style.display = 'none'; }

        function updateUI() {
            skillListUI.innerHTML = inventory.length ? 
                inventory.map(s => `<span class="skill-tag">${s}</span>`).join('') : "Vazia";
            
            const count = requiredSkills.filter(s => inventory.includes(s)).length;
            gateStatusUI.innerText = `GATE ACCESS: ${count}/3 SKILLS`;
        }

        viewport.addEventListener('scroll', () => {
            const pctX = viewport.scrollLeft / (viewport.scrollWidth - viewport.clientWidth);
            const pctY = viewport.scrollTop / (viewport.scrollHeight - viewport.clientHeight);
            const mapW = document.getElementById('mini-map').clientWidth;
            const mapH = document.getElementById('mini-map').clientHeight;
            const posX = (pctX * (mapW * 0.9)) + (mapW * 0.05);
            const posY = (pctY * (mapH * 0.9)) + (mapH * 0.05);
            dot.style.left = `${posX}px`;
            dot.style.top = `${posY}px`;
            light.style.background = `radial-gradient(circle 80px at ${posX}px ${posY}px, rgba(0, 255, 65, 0.25) 0%, #000 100%)`;
        });
    </script>
</body>
</html>